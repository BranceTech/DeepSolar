<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="static/js/bootstrap.min.css" rel="stylesheet">

    <title>Deep Solaris</title>

    <style type="text/css">
      .vertical {
        width:800px;
        height:800px;

        display: flex;
        justify-content: center;
        /*margin: 0 auto;*/
 /*       text-align: center;*/
        /*border: 1px solid black;*/
      }

      .centerBtn{
        display: flex;
        justify-content: center;
        border: 5px ;
      }



    </style>
  </head>
  <body>


    <div class = "container vertical inline" > 
      <img src="static/default.jpg" class ="img-circle" width="100%" height="100%">
    </div>

    <div>
      <select class="form-control" id='country'>
        <option value="Germany">Germany</option>
        <option value="Netherlands">Netherlands</option>
      </select>
    </div>

    <div class="form-group centerBtn">
      <input type="text" name="GPS_X" id = "GPS_X" placeholder="GPS_X">
      <input type="text" name="GPS_Y"  id = "GPS_Y" placeholder="GPS_Y">
      <input type="text" id = "X_range" placeholder="X_range(max500)">
      <input type="text" id = "Y_range" placeholder="Y_range(max500)">
      <input type="text" id = "resolution" placeholder="resolution(max5000)">
    </div>

    <div class="centerBtn inline">
      <button class="btn btn-primary"  type="button" id = "getImageBtn">GetImage</button>
      <button class="btn btn-primary"  type="button" id = "DetectPanelBtn" >Detect</button>
    </div>

    <div class="modal fade" id="popUp" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Label Image</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id = "modal-body">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id = "One">T_Positive</button>
            <button type="button" class="btn btn-primary" id = "Two">F_Positive</button>
            <button type="button" class="btn btn-primary" id = "Three">T_Negative</button>
            <button type="button" class="btn btn-primary" id = "Four">F_Negative</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Optional JavaScript -->
    
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="static/js/jquery-3.3.1.min.js"></script>
    <script src="static/js/bootstrap.min.js"></script>
        <!-- Germany coordinate -->
<!-- Aachen: center = (6.08342,50.77664) 
Bonn: bonn_center=(7.0982, 50.7374) 
Essen: essen_center=(7.0116, 51.4556) 
Dortmund: dortmun_center=(7.4653,51.5136) 
Duisburg: duisburg_center=(6.7623,51.4344) 
Monschau: monschau_center= (6.256389,50.56) 
Bochum: center = (7.216236, 51.481846) 
koln residential area: center = (7.060243,50.882887) 
Dusseldorf: center = (6.77616,51.22172)  -->


<!-- Heerlen (5.9794988,50.8881742) -->
    <script>

        var click_X
        var click_Y
        var imgName 
        var imageSize = 800 

        $("img").on("click", function(event) {
          var x = event.pageX - this.offsetLeft;
          var y = event.pageY - this.offsetTop;
          // alert("X Coordinate: " + x + " Y Coordinate: " + y);
          click_X = x
          click_Y = y

          var mymodal = $("#popUp");
          mymodal.find('.modal-body').text('X: ' + x + " Y: " + y);
          mymodal.modal('show');
          imgName = $('img').attr('src')

         });

        $("#getImageBtn").click(function(){

          var gps_x = $("#GPS_X").val()
          var gps_y = $("#GPS_Y").val()
          var country = $("#country").val()
          var x_range = $("#X_range").val()
          var y_range = $("#Y_range").val()
          var resolution = $("#resolution").val()
          if (x_range >500 || y_range>500 || x_range<0 || y_range<0 ){
            alert("The range doesn't fit ")
          }
          else{
            var data = {
              'gps_x':gps_x,
              'gps_y':gps_y,
              'country':country,
              'x_range':x_range,
              'y_range':y_range,
              'resolution':resolution
            }

            $.ajax({
              type:'GET',
              url:'http://127.0.0.1:5000/downloadPic',
              data:data,
              dataType:'json',//希望服务器返回json格式的数据
              success:function(data){
                // alert(JSON.stringify(data))
                 //data["url"]   
                $('img').attr('src',data['url'])
                alert(data['url'])    
                     }
            })
          }

        })

        $('#DetectPanelBtn').click(function(){
          url = $('img').attr('src')
          var data  ={
            'Detect': true,
            'url': url
          }
          $.ajax({
            type:'GET',
            url:'http://127.0.0.1:5000/detectSolarPanel',
            data:data,
            dataType:'json',//希望服务器返回json格式的数据
            success:function(data){
              $('img').attr('src',data['url'])    
              alert('Detect solar panel pic successfully ' + data['url'])    
                   }
          })
        });
        $('#One').click(function(){
          alert("Click One" + click_X + " " + click_Y)
          var data = {
            'type':'one',
            'img':imgName,
            'click_X':parseFloat(click_X/imageSize),
            'click_Y':parseFloat(click_Y/imageSize)
          }
          $.ajax({
            type:'GET',
            url:'http://127.0.0.1:5000/labelData',
            data:data,
            dataType:'json',//希望服务器返回json格式的数据
            success:function(data){ 
              alert('label successfully')    
                   }
          })  
        })

        $('#Two').click(function(){
          alert("Click Two" + click_X + " " + click_Y)
          var data = {
            'type':'two',
            'img':imgName,
            'click_X':parseFloat(click_X/imageSize),
            'click_Y':parseFloat(click_Y/imageSize)
          }
          $.ajax({
            type:'GET',
            url:'http://127.0.0.1:5000/labelData',
            data:data,
            dataType:'json',//希望服务器返回json格式的数据
            success:function(data){ 
              alert('label successfully')    
                   }
          })                    

        })

        $('#Three').click(function(){
          alert("Click Three" + click_X + " " + click_Y)
          var data = {
            'type':'three',
            'img':imgName,
            'click_X':parseFloat(click_X/imageSize),
            'click_Y':parseFloat(click_Y/imageSize)
          }
          $.ajax({
            type:'GET',
            url:'http://127.0.0.1:5000/labelData',
            data:data,
            dataType:'json',//希望服务器返回json格式的数据
            success:function(data){ 
              alert('label successfully')    
                   }
          })   

        })

        $('#Four').click(function(){
          alert("Click Four" + click_X + " " + click_Y)
          var data = {
            'type':'four',
            'img':imgName,
            'click_X':parseFloat(click_X/imageSize),
            'click_Y':parseFloat(click_Y/imageSize)
          }
          $.ajax({
            type:'GET',
            url:'http://127.0.0.1:5000/labelData',
            data:data,
            dataType:'json',//希望服务器返回json格式的数据
            success:function(data){ 
              alert('label successfully')    
                   }
          })  
        })

    </script>

  </body>
</html>